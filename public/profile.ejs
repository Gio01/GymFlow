<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GymFlow</title>
    <link rel="stylesheet" href="./styles/index.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>


    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>

    <div class="wrapper" style="display: flex; flex-direction: column;">
	    <div id="top_nav" class="top_navbar">
            <div class="hamburger">
                <div class="one"></div>
                <div class="two"></div>
                <div class="three"></div>
            </div>
            <div class="top_menu">
                <div class="logo">
			<img src="./img/GymFlow.jpeg" alt="GymFlow"
			style="height: 50%; width: 55%;">
		</div>
                <ul>
                    <li>
                        <a href="/login" display="none">
                            <i class="fas fa-user"></i>
                        </a>
                    </li>
                    <br>
                    <li>
                        <a href="#" class="logged-out" display="none" id="logout">
                            <i class="fas fa-sign-out-alt" style="padding-top: 0;"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="sidebar" style="display: flex; position:fixed; height: 100%;">
            <ul>
                <li>
                    <a href="/" display="none">
                        <span class=" icon"><i class="fas fa-home"></i></span>
                        <span class="title">Home</span>
                    </a>
                </li>
                <li>
                    <a href="/fitness" display="none">
                        <span class="icon"><i class="fas fa-dumbbell"></i></span>
                        <span class="title">Fitness</span>
                    </a>
                </li>
                <li>
                    <a class="logged-in" href="/profile" display="none">
                        <span class="icon"><i class="fas fa-id-card"></i></span>
                        <span class="title">Profile</span>
                    </a>
                </li>
                <li>
                    <a href="/program" display="none">
                        <span class="icon"><i class="fa fa-map-signs" aria-hidden="true"></i></span>
                        <span class="title">Program</span>
                    </a>
                </li>
                <li>
                    <a href="/contact" display="none">
                        <span class="icon"><i class="fas fa-address-book" style="float:right;"></i></span>
                        <span class="title">Contact</span>
                    </a>
                   
                </li>
            </ul>
        </div>
        <!--Main Content------------------>

        <div class="main_container" style="margin-top: 20px;">

            <br>
            <br>
            <div class="item">
                <h1>Profile</h1>
           
                <br>
                <div class="user-name"></div>
                <br>
                <div class="image-link"></div>
                <br>
                  <!-- Trigger/Open The Modal -->
                  <i class="fas fa-edit" id="myBtn"></i>

                  <!-- The Modal -->
                  <div id="myModal" class="modal">
 
                     <!-- Modal content -->
                 <div class="modal-content">
                     <span class="close">&times;</span>
                     <h3>Change Your UserName:</h3>
                     <br>
                     <label for="update-picture">Profile Picture (Enter Image Link):</label><br>
                     <input id="update-picture" type="text" style="height: 40%; width: 40%;">
                     <br>
                     <label for="update-userName">UserName:</label><br>
                     <input id="update-userName" type="text" style="height: 40%; width: 40%;">
                     <br>
                     <br>
                     <button id="submit-userName">Submit</button>
                 </div>
 
                 </div>
            </div>

            <div class="item">
                <h1>Bio</h1>
                <br />
                <div class="bio"></div>
                <br>

                 <!-- Trigger/Open The Modal -->
                <i class="fas fa-edit" id="bio-button"></i>

                 <!-- The Modal -->
                 <div id="bioModal" class="modal">

                    <!-- Modal content -->
                <div class="modal-content">
                    <span class="closeB">&times;</span>
                    <h3>Change Your Bio:</h3>
                    <br>
                    <label for="update-bio">Bio:</label><br>
                    <input id="update-bio" type="text" style="height: 40%; width: 40%;">
                    <br>
                    <br>
                    <button id="submit-bio">Submit</button>
                </div>

                </div>
            </div>

            <div class="item">
                <h1>Fitness Profile</h1>
                <br />
                <div class="fitnessH"></div>
                <div class="fitnessW"></div>
                <div class="fitnessG"></div>
                <br>
                 <!-- Trigger/Open The Modal -->
                <i class="fas fa-edit" id="fitness-button"></i>

                 <!-- The Modal -->
                 <div id="fitnessModal" class="modal">

                    <!-- Modal content -->
                <div class="modal-content">
                    <span class="closeF">&times;</span>
                    <h3>Change Your Fitness Profile:</h3>
                    <br>
                    <label>How Tall Are You?</label><br>
                    <label for="update-heightF">Feet:</label><br>
                    <input id="update-heightF" style="height: 40%; width: 20%;">
                    <br>
                    <label for="update-heightI">Inches:</label><br>
                    <input id="update-heightI" style="height: 40%; width: 20%;">
                    <br><br>
                    <label for="update-weight">Weight in Pounds (lbs):</label><br>
                    <input id="update-weight" type="text" style="height: 40%; width: 40%;">
                    <br><br>
                    <label for="update-goals">Goal You Want To Accomplish:</label><br>
                    <input id="update-goals" type="text" style="height: 40%; width: 40%;">

                    <br>
                    <br>
                    <button id="submit-fitness">Submit</button>
                </div>

                </div>
            </div>

            <div class="item"> 
                <div class="profile-data"></div>
            </div>

</div>
            <!---Main content ends ------------------>

        </div>

    </div>
    </div>
    <script src="./scripts/modal.js"></script>
    <script src="./scripts/navscripts.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-firestore.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-analytics.js"></script>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCVqKw0SWmEoRtIiJaCM-hRJUxRA3Mbc1g",
            authDomain: "gymflow-47c9b.firebaseapp.com",
            databaseURL: "https://gymflow-47c9b.firebaseio.com",
            projectId: "gymflow-47c9b",
            storageBucket: "gymflow-47c9b.appspot.com",
            messagingSenderId: "728577478893",
            appId: "1:728577478893:web:d86266b8cfa6b13f99bce4",
            measurementId: "G-M97878F1TC"};
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Make auth and firestore references!
        const auth = firebase.auth();
        const db = firebase.firestore();

        //listen for auth
        auth.onAuthStateChanged(user => {
            //if user is logged in then show data & if not then don't show anything
            if (user) {
                //console.log(user);

                setupUI(user) //we need to pass the user into the setupUI
                //to allow for the UI to appwar based on when the user is logged in or not

            } else {
                exercises([]);


            }

        });
        //logout method
        const logout = document.querySelector("#logout");
        logout.addEventListener('click', (e) => {
            e.preventDefault();
            auth.signOut().then(() => {
                console.log("User Logged Out!");
            });
        })


        const loggedOutLinks = document.querySelectorAll('.logged-out');
        const loggedInLinks = document.querySelectorAll('.logged-in');
        const profileData = document.querySelector('.profile-data');
        const bio = document.querySelector('.bio');
        const uname = document.querySelector('.user-name');
        const ilink = document.querySelector('.image-link');
        const fitnessH = document.querySelector('.fitnessH');
        const fitnessW = document.querySelector('.fitnessW');
        const fitnessG = document.querySelector('.fitnessG');
        const workouts = document.querySelector('#workouts');
        const submitBio = document.querySelector("#submit-bio");
        const submitUserName = document.querySelector("#submit-userName");
        const submitFitness = document.querySelector("#submit-fitness");

        const setupUI = user => {
            if (user) {
                // user account info on an update event listener
                const doc = db.collection('users').doc(user.uid).collection('userInfo').doc('info');
                const observer = doc.onSnapshot(docSnapshot => {
                    var html = `<div> Logged in as ${docSnapshot.data().userName}</div>`;
                    profileData.innerHTML =
                        html; // we are assigng the value of profile to be the html variable
                    if (docSnapshot.data().bio) {
                        var ubio = `<div> ${docSnapshot.data().bio}</div>`
                        bio.innerHTML = ubio;
                    } else {
                        console.log('no user bio')
                    }

                    if (docSnapshot.data().userName) {
                        var uName =  `<div> Username: ${docSnapshot.data().userName}</div>`
                        uname.innerHTML = uName;
                    } else {
                        console.log('no username')
                    }

                    if (docSnapshot.data().imageLink) {
                        var link =  `<img src="${docSnapshot.data().imageLink}" alt="image" style="max-height: 10%; max-width:10%;"> </img>`
                        ilink.innerHTML = link;
                    } else {
                        console.log('no username')
                    }

                    if (docSnapshot.data().Height) {
                        var height = `<div> Height: ${docSnapshot.data().Height}</div>`
                        fitnessH.innerHTML = height;
                    } else {
                        console.log('No height');
                    }
                    
                    if (docSnapshot.data().Weight) {
                        var weight = `<div> Weight Lbs: ${docSnapshot.data().Weight}</div>`
                        fitnessW.innerHTML = weight;
                    } else {
                        console.log('No weight');
                    }
                    
                    if (docSnapshot.data().Goals) {
                        var goals = `<div> Goals: ${docSnapshot.data().Goals}</div>`
                        fitnessG.innerHTML = goals;
                    } else {
                        console.log('No goals');
                    }
                }, err => {
                    console.log(err)
                })
              
                //toggle UI elements
                loggedInLinks.forEach(item => {
                    item.style.display = 'block'
                });
                loggedOutLinks.forEach(item => {
                    item.style.display = 'none'
                })

                submitBio.addEventListener('click', e => {
            
                    $.ajax({
                        type: "POST",
                        url: "http://localhost:5001/gymflow-47c9b/us-central1/api/updateUser",
                        data: {
                            bio: $("#update-bio").val(),
                            user: user.email,
                        },
                        success: function(result) {
                            alert("Updating Bio Was Successful")
                        },
                        error: function(err) {
                            alert("Updating Bio Failed")
                        }
                    });
                })

                submitUserName.addEventListener('click', e => {

                    $.ajax({
                        type: "POST",
                        url: "http://localhost:5001/gymflow-47c9b/us-central1/api/updateUser",
                        data: {
                         userName: $("#update-userName").val(),
                         image: $("#update-image").val(),
                            user: user.email,
                        },
                        success: function(result) {
                            alert("Updating Profile Was Successful")
                        },
                        error: function(err) {
                            alert("Updating Prodile Failed")
                        }
                    });
                })

                submitFitness.addEventListener('click', e => {
                    $.ajax({
                        type: "POST",
                        url: "http://localhost:5001/gymflow-47c9b/us-central1/api/updateUser",
                        data: {
                        Weight: $("#update-weight").val(),
                        Height: $("#update-heightF").val() + "''" + $("#update-heightI").val(),
                        Goals: $("#update-goals").val(),
                            user: user.email,
                        },
                        success: function(result) {
                            alert("Updating Fitness Profile Was Successful")
                        },
                        error: function(err) {
                            alert("Updating Fitness Profile Failed")
                        }
                    });

                })


            } else {

                profileData.innerHTML = '';

                loggedInLinks.forEach(item => {
                    item.style.display = 'none'
                });
                loggedOutLinks.forEach(item => {
                    item.style.display = 'block'
                })
            }
        };
    </script>

</body>

</html>
